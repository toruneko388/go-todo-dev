
# 業務要件（業務フロー）
開始点：ログイン
終了点：アプリ終了
図は別ファイル

# 機能要件、非機能要件
機能要件
- **ユーザー管理**
  - ユーザがログインできる
- **データ操作（CRUD）**
  - Todoを一覧表示できる
  - Todoを追加できる
  - Todoを削除できる
  - Todoの編集ができる
- **状態管理・表示**
  - Todoを完了済みにできる
  - 完了／未完了のフィルタ表示ができる
  - 各ユーザーごとにTodoを管理できる（ログイン後のユーザーに紐づく）
- **UI・入力処理**
  - Todoにタイトルをつけられる
- **データ属性**
  - 各Todoに期限を設定できる

非機能要件
- **パフォーマンス**
  - 同時に10人まで使える
- **可用性・信頼性**
  - データはサーバ再起動後も残る（永続化）
  - データはSQLiteに保存される
  - セッションによってログイン状態を管理する
  - 日本語環境で動作する
- **セキュリティ**
  - セキュリティ上、POSTはCSRF対策を入れる
  - セッションによってログイン状態を管理する
  - CORSを考慮する（将来に別フロントも考慮）
- **保守性・品質**
  - ログをファイルに記録する
  - テストコードを一部に書く
- **拡張性・相互運用性**
  - JSON形式のAPIも提供する
  - CORSを考慮する（将来に別フロントも考慮）

# 📺 画面要件（Todoアプリ）

## 1. ログイン画面（`GET /login`）

| 項目    | 内容                                        |
| ----- | ----------------------------------------- |
| 表示内容  | - ユーザー名入力欄（テキストボックス）<br>- ログインボタン（submit） |
| 操作    | - ユーザー名を入力して「ログイン」をクリック                   |
| 遷移    | - ログイン成功 → `/todos` にリダイレクト               |
| エラー表示 | - 入力なし or 無効なユーザーなら、同画面上部にエラーメッセージを表示     |
| その他   | - セッションでログイン状態を保持する                       |

---

## 2. Todo一覧／追加画面（`GET /todos`）

| 項目         | 内容                                                            |
|--------------|-----------------------------------------------------------------|
| 表示内容     | - Todoの一覧（タイトルのみ、完了フラグなし）<br>- 新規追加フォーム（1行） |
| 操作         | - タイトルを入力して「追加」ボタンを押す                          |
| 遷移         | - 追加成功後も同じ画面（`/todos`）にリダイレクト                  |
| 表示条件     | - ログイン済みのユーザーだけ閲覧可能（未ログインなら`/login`に戻す）     |
| エラー表示   | - 空のタイトルでPOSTした場合は上部に「タイトルが必要です」など表示      |

---

### 画面構成図（簡易）

```
+----------------------------+
| Login Page (/login)       |
| ------------------------  |
| [username: _________]     |
| [ Login ]                 |
+----------------------------+

→ 成功後に遷移 ↓

+----------------------------+
| Todo List (/todos)        |
| ------------------------  |
| - Buy groceries            |
| - Walk the dog            |
|                          |
| [ New Todo: _________ ]   |
| [ Add ]                   |
+----------------------------+
```

# 🧾 入力・出力要件（Todoアプリ）

---

## 1. Todo追加（POST /todos）

### 入力要件

| パラメータ | 種類   | 必須 | 制約                         | 備考               |
|------------|--------|------|------------------------------|--------------------|
| title      | string | ✅   | 1〜100文字、日本語可、空禁止 | フォームのテキストボックス |

### 出力要件

| 状況        | 出力内容                                               |
|-------------|--------------------------------------------------------|
| 正常時      | 新しいTodoを追加し、`/todos`にリダイレクト              |
| 入力ミス    | `title` が空なら、フォーム上部に「タイトルは必須です」と表示 |
| サーバ内部エラー | ステータス500、共通エラー画面またはエラーメッセージ表示     |

---

## 2. Todo一覧表示（GET /todos）

### 入力要件

- なし（ただし、ログイン状態が必要）

### 出力要件

| 状況              | 出力内容                                               |
|-------------------|--------------------------------------------------------|
| ログイン済み      | 現在のTodo一覧をHTMLテンプレートで表示                     |
| 未ログイン        | `/login` にリダイレクト                                  |

---
# 🚨 エラー要件（Todoアプリ）

---

## 共通ポリシー

- エラー時は可能な限り **元の画面に戻して**ユーザーに理由を明示する
- サーバ内部エラー（500など）はシステム側でログに記録し、ユーザーには簡素なメッセージのみ表示
- 入力エラーはHTML画面上部に目立つように表示する

---

## 1. Todo追加（POST /todos）

| エラー条件               | 表示メッセージ              | ステータス | 対応                  |
|--------------------------|-----------------------------|------------|------------------------|
| `title` が空             | 「タイトルは必須です」      | 200        | 元画面に戻して表示     |
| `title` が100文字超え    | 「タイトルは100文字以内です」| 200        | 同上                  |
| 内部エラー（panicなど）   | 「システムエラーが発生しました」| 500        | ログ出力、共通画面表示 |

---

## 2. Todo一覧（GET /todos）

| エラー条件       | 表示メッセージ            | ステータス | 対応                    |
|------------------|---------------------------|------------|--------------------------|
| 未ログイン       | なし（リダイレクトのみ）   | 302        | `/login` にリダイレクト |
| 内部エラー        | 「一覧の取得に失敗しました」 | 500        | ログ出力、共通画面表示 |

---

## 3. ログイン（GET/POST /login）

| エラー条件       | 表示メッセージ             | ステータス | 対応                  |
|------------------|----------------------------|------------|------------------------|
| 入力が空         | 「ユーザー名を入力してください」| 200        | フォーム上部に表示     |
| 内部エラー        | 「ログイン処理中にエラーが発生しました」| 500 | ログ出力、簡素表示     |
# 🗃️ データ要件（Todoアプリ）

---

## 1. データ構造と属性（モデル仕様）

### Todoテーブル（または構造体）

| フィールド名 | 型     | 必須 | 初期値     | 制約                             |
|--------------|--------|------|------------|----------------------------------|
| `ID`         | int    | ✅   | 自動採番   | 一意、連番                       |
| `Title`      | string | ✅   | なし       | 最大100文字、日本語可、空禁止       |
| `Done`       | bool   | ✅   | `false`    | 完了フラグ（true:完了）          |
| `UserID`     | int    | ❌   | null/0     | 多ユーザー対応を想定した外部キー（将来拡張） |

---

## 2. データ保存形式

| 項目              | 内容                                         |
|-------------------|----------------------------------------------|
| ストレージ方式     | 現在はメモリ保存。将来的にはSQLiteを予定         |
| 保存先ファイル例   | `data/todos.db` または `todos.json` など       |
| 永続化タイミング   | 初期は未対応。拡張後は操作のたびに保存予定       |
| バックアップ方針   | 本番導入時は定期バックアップスクリプトを検討     |

---

## 3. データ整合性・一貫性

| ポリシー名               | 内容                                           |
|--------------------------|------------------------------------------------|
| IDの一意性               | `ID` は衝突しないよう自動採番で管理する（nextID等） |
| タイトルの検証           | 空文字・100文字超過は登録不可                      |
| 多重送信の防止（予定）   | 同一タイトルの短時間連続登録を抑制する（将来対応）     |
| 外部参照制約（将来対応） | `UserID` は存在するユーザーIDである必要（外部キー）     |

---

## 4. 初期データ（任意）

```json
[
  {
    "ID": 1,
    "Title": "アプリ設計を決める",
    "Done": true
  },
  {
    "ID": 2,
    "Title": "Todo追加機能を実装する",
    "Done": false
  }
]
```

---

## 5. データ拡張予定（将来追加する可能性）

| フィールド名 | 内容                     |
|--------------|--------------------------|
| `DueDate`    | 締切日（`YYYY-MM-DD`）形式で保持 |
| `CreatedAt`  | 作成日時（タイムスタンプ）      |
| `UpdatedAt`  | 最終更新日時                   |

